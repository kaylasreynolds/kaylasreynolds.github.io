<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Client Management</title>
:root{
  --grad1:#4c51bf; --grad2:#553c9a;
  --ok:#2f855a;--ok2:#276749;
  --danger:#c53030;--danger2:#97266d;
  --text:#222;--muted:#555;--muted2:#888;
  --card:rgba(255,255,255,.97);
  --surface:#f6f7fb;
  --ring:#dcdde3;
  --shadow:0 12px 30px rgba(0,0,0,.12);
  --radius:16px;
  --radius-sm:12px;
  --radius-xs:10px;
  --focus:0 0 0 3px rgba(76,81,191,.25);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Inter, Roboto, Ubuntu, sans-serif;
  color:var(--text);
  background:linear-gradient(135deg,var(--grad1),var(--grad2)) fixed;
}

/* Layout shell */
.container{
  max-width:1200px;
  margin:auto;
  padding:28px 20px 64px;
}

header{
  display:flex; align-items:center; justify-content:space-between;
  gap:16px; margin-bottom:18px;
}
header h1{
  margin:0; font-weight:800; letter-spacing:.3px; color:#fff;
  text-shadow:0 2px 14px rgba(0,0,0,.18);
}

/* Toolbar */
.toolbar{
  display:flex; align-items:center; gap:10px;
}

.btn{
  appearance:none; border:1px solid rgba(255,255,255,.35);
  background:rgba(255,255,255,.15);
  color:#fff; font-weight:600;
  padding:10px 14px; border-radius:999px;
  backdrop-filter: blur(6px);
  cursor:pointer; transition:transform .08s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
}
.btn:hover{ background:rgba(255,255,255,.22) }
.btn:active{ transform:translateY(1px) }
.btn:focus-visible{ outline:none; box-shadow:var(--focus) }
.btn.ghost{
  border-color:rgba(255,255,255,.28);
}
.btn.danger{
  border-color:transparent;
  background:linear-gradient(180deg,var(--danger),var(--danger2));
}
.btn.small{ font-size:.92rem; padding:8px 10px }

/* Card surface */
.surface{
  background:var(--card);
  border:1px solid var(--ring);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:18px;
}

/* Search row / filters (optional if you add later) */
.row{ display:flex; flex-wrap:wrap; gap:12px; align-items:center }
.input{
  background:#fff; border:1px solid var(--ring); border-radius:999px;
  padding:10px 14px; min-width:260px; color:var(--text);
}
.select{
  appearance:none; background:#fff; border:1px solid var(--ring);
  border-radius:999px; padding:10px 38px 10px 14px; position:relative;
}
.badge{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px; font-weight:600;
  background:#eef0ff; color:#3842c0; border:1px solid #dfe3ff;
}

/* Dropdown (Export ‚ñæ) */
.toolbar .dropdown{ position:relative }
.dropdown-menu{
  position:absolute; right:0; top:calc(100% + 8px);
  background:var(--card); border:1px solid var(--ring);
  border-radius:var(--radius-sm); box-shadow:var(--shadow);
  padding:6px; min-width:220px; display:none; z-index:50;
}
.dropdown-menu.show{ display:block }
.dropdown-menu .btn{
  width:100%; text-align:left; color:#1a1a1a; background:transparent; border:1px solid transparent;
}
.dropdown-menu .btn:hover{ background:#f3f4f8; border-color:#e9eaf1; color:#111 }

/* Tabs (if in your app) */
.tabs{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 16px }
.tab{
  background:#fff; border:1px solid var(--ring); color:#333;
  padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:600;
}
.tab.active{ background:linear-gradient(180deg,#fff,#f7f8ff); border-color:#cfd2e6; color:#2a2f8a; box-shadow:0 6px 18px rgba(44,53,170,.12) }

/* Tables (if you show lists) */
.table{
  width:100%; border-collapse:separate; border-spacing:0; overflow:hidden;
  border:1px solid var(--ring); border-radius:var(--radius-sm); background:#fff;
}
.table thead th{
  text-align:left; font-size:.9rem; color:#555; background:#f5f6fb;
  padding:12px 14px; border-bottom:1px solid var(--ring);
}
.table tbody td{
  padding:12px 14px; border-bottom:1px solid #eee;
}
.table tbody tr:hover{ background:#fafbff }

/* Chips / tags */
.chip{
  background:#f0f1ff; color:#3a42c0; border:1px solid #e0e3ff;
  padding:6px 10px; border-radius:999px; font-weight:600; display:inline-flex; gap:6px; align-items:center
}

/* Footer hint */
.footer{
  margin-top:18px; color:#f0f1ff; opacity:.9; font-size:.95rem
}

/* Responsive */
@media (max-width: 720px){
  .toolbar{ flex-wrap:wrap; }
  .btn{ width:100% }
  .dropdown-menu{ right:0; left:auto; min-width:100% }
}

/* Utility spacing */
.mt-12{ margin-top:12px }
.mt-16{ margin-top:16px }
.mt-24{ margin-top:24px }

</head>
<body>
  <div class="container">
    <header>
      <h1>Client Management</h1>
      <div class="toolbar">
        <button id="exportBtn" class="btn ghost">‚¨áÔ∏è Export JSON</button>
        <button id="exportCsvBtn" class="btn ghost">‚¨áÔ∏è Export CSV</button>
       <div class="dropdown" id="importDropdown">
  <button class="btn ghost" id="importToggle">‚¨ÜÔ∏è Import ‚ñæ</button>
  <div class="dropdown-menu" id="importMenu">
    <button id="importJsonBtn" class="btn small ghost" style="width:100%">Import JSON</button>
    <input id="importJsonFile" type="file" accept="application/json" style="display:none">

    <button id="importCsvCombinedBtn" class="btn small ghost" style="width:100%">Import CSV</button>
    <input id="importCsvCombinedFile" type="file" accept=".csv" style="display:none">
  </div>
</div>
    </header>

    <div class="tabs" role="tablist">
      <button class="tab active" data-tab="dashboard">üìä Dashboard</button>
      <button class="tab" data-tab="clients">üë• Clients</button>
      <button class="tab" data-tab="appointments">üìÜ Appointments</button>
      <button class="tab" data-tab="sales">üí∞ Sales History</button>
      <!-- replace the Outreach + Seasonal buttons with this -->
<div class="tab-dropdown" id="outreachDropdown">
  <button class="tab" data-tab="outreach" aria-haspopup="true" aria-expanded="false">
    üì£ Outreach ‚ñæ
  </button>
  <div class="tab-submenu" role="menu" aria-label="Outreach submenu">
    <button class="tab submenu" data-tab="outreach" role="menuitem">üì£ Outreach</button>
    <button class="tab submenu" data-tab="seasonal" role="menuitem">üçÉ Seasonal Updates</button>
  </div>
</div>

      <button class="tab" data-tab="birthdays">üéÇ Birthdays</button>
      
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="tab-content">
      <div class="stats-grid">
        <div class="card"><div class="stat-number" id="salesMTD">$0</div><div class="muted">Sales MTD</div></div>
        <div class="card"><div class="stat-number" id="salesYTD">$0</div><div class="muted">Sales YTD</div></div>
        <div class="card"><div class="stat-number" id="apptMTD">0</div><div class="muted">Appointments MTD</div></div>
        <div class="card"><div class="stat-number" id="apptYTD">0</div><div class="muted">Appointments YTD</div></div>
        <div class="card"><div class="stat-number" id="pastDueOutreach">0</div><div class="muted">Past Due Outreach</div></div>
      </div>
      <h3>Upcoming</h3>
      <div id="upcomingList" class="list"></div>
      <h3>Follow-Up Tracking</h3>
      <div class="followup-sections">
        <div class="followup-card"><strong>Open To-Dos</strong><div id="fuOpen" class="todo-list"></div></div>
        <div class="followup-card"><strong>Past Due</strong><div id="fuPast" class="todo-list"></div></div>
        <div class="followup-card"><strong>911 Follow-Ups</strong><div id="fuUrgent" class="todo-list"></div></div>
        <div class="followup-card"><strong>This Week</strong><div id="fuWeek" class="todo-list"></div></div>
      </div>
    </div>

    <!-- Clients -->
    <div id="clients" class="tab-content" style="display:none">
      <div class="card">
        <div class="client-top" style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap;margin-bottom:12px">
          <div style="flex:1;min-width:220px">
            <h2 style="margin:0">Client List</h2>
            <div class="toolbar" style="margin-top:8px">
              <div class="dropdown" id="filterDropdown">
                <button class="btn ghost" id="filterToggle">Filter ‚ñæ</button>
                <div class="dropdown-menu" id="filterMenu">
                  <label>Styles</label>
                  <select id="filterStyles" multiple>
                    <option value="Classic">Classic</option>
                    <option value="Minimalist">Minimalist</option>
                    <option value="Casual">Casual</option>
                    <option value="Business">Business</option>
                  </select>
                  <label>Brands</label>
                  <input id="filterBrand" list="brandList">
                  <label>Sort By</label>
                  <select id="filterSort">
                    <option value="">None</option>
                    <option value="lastAsc">Last Name Ascending</option>
                    <option value="lastDesc">Last Name Descending</option>
                    <option value="firstAsc">First Name Ascending</option>
                    <option value="firstDesc">First Name Descending</option>
                  </select>
                  <button id="clearFilters" class="btn small ghost" style="margin-top:4px;width:100%">Clear Filters</button>
                </div>
              </div>
              <input type="text" id="clientSearch" placeholder="Search clients">
            </div>
          </div>
          <div style="text-align:right;min-width:180px">
            <div id="clientCount" class="muted" style="font-weight:700;margin-bottom:10px"></div>
            <button id="openClientBtn" class="btn primary">Create Client</button>
          </div>
        </div>
        <datalist id="brandList"></datalist>
        <div class="list" id="clientList"></div>
      </div>
    </div>

    <!-- Appointments -->
    <div id="appointments" class="tab-content" style="display:none">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:12px">
          <h2 style="margin:0">Appointments</h2>
          <button id="openApptBtn" class="btn primary">+ Schedule</button>
        </div>
        <div class="list" id="apptList"></div>
      </div>
    </div>

    <!-- Sales -->
    <div id="sales" class="tab-content" style="display:none">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:12px">
          <h2 style="margin:0">Sales History</h2>
          <button id="openSaleBtn" class="btn primary">+ Log Sale</button>
        </div>
        <div class="list" id="saleList"></div>
      </div>
    </div>

    <!-- Outreach -->
    <div id="outreach" class="tab-content" style="display:none">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:12px">
          <h2 style="margin:0">Outreach</h2>
          <button id="openTodoBtn" class="btn primary">+ Add Outreach</button>
        </div>
        <div class="list" id="todoList"></div>
      </div>
    </div>

    <!-- Birthdays -->
    <div id="birthdays" class="tab-content" style="display:none">
      <div class="card">
        <h2 style="margin-top:0">Birthdays</h2>
        <div id="birthdayCalendar" class="calendar"></div>
        <h3>All Birthdays</h3>
        <div id="birthdayList" class="list"></div>
      </div>
    </div>

    <!-- Seasonal Updates -->
    <div id="seasonal" class="tab-content" style="display:none">
      <div class="card">
        <h2 style="margin-top:0">Seasonal Updates</h2>
        <p class="muted" style="margin:8px 0 12px">
          Check a box when you‚Äôve done that season‚Äôs outreach. Uncheck to reopen.
        </p>
        <table class="season-table" id="seasonTable">
          <thead><tr><th>Client</th><th>Spring</th><th>Summer</th><th>Fall</th><th>Winter</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </div> <!-- container -->

  <!-- Client Modal -->
  <div class="modal" id="clientModal">
    <div class="panel">
      <header><h3 id="clientModalTitle">New Client</h3><button class="x" onclick="closeModal('clientModal')">‚úï</button></header>
      <div class="row-cols">
        <div><label>First Name<input id="clientFirst"></label></div>
        <div><label>Last Name<input id="clientLast"></label></div>
      </div>
      <label>Email<input id="clientEmail" type="email"></label>
      <label>Phone<input id="clientPhone"></label>
      <label>Birthday<input id="clientBirthday" type="date"></label>
      <label>Preferred Styles<select id="clientStyles" multiple>
        <option value="Classic">Classic</option>
        <option value="Minimalist">Minimalist</option>
        <option value="Casual">Casual</option>
        <option value="Business">Business</option>
      </select></label>
      <label>Preferred Brands<input id="clientBrands" list="brandList" placeholder="Comma separated"></label>
      <div class="row-cols">
        <div><label>Shirt Size<input id="clientSizeShirt"></label></div>
        <div><label>Dress Size<input id="clientSizeDress"></label></div>
        <div><label>Pant Size<input id="clientSizePant"></label></div>
        <div><label>Shoe Size<input id="clientSizeShoe"></label></div>
      </div>
      <label>Initial Sales Amount<input id="clientInitial" type="number" step="0.01"></label>
      <label>Notes<textarea id="clientNotes"></textarea></label>
      <div class="buttons" style="justify-content:flex-end">
        <button class="btn ghost" onclick="closeModal('clientModal')">Cancel</button>
        <button class="btn primary" id="saveClientBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Client Detail Modal -->
  <div class="modal" id="clientDetailModal">
    <div class="panel">
      <header><h3 id="clientDetailName"></h3><button class="x" onclick="closeModal('clientDetailModal')">‚úï</button></header>
      <div id="clientInfo" class="list"></div>
      
      <h4>Seasonal Updates</h4>
<div id="clientSeasons"></div>
<div id="clientTimeline" class="list"></div>
      <div class="buttons" style="justify-content:flex-end">
        <button class="btn" onclick="openAppointmentModal(null,[currentDetailClient])">Book Appointment</button>
        <button class="btn" onclick="openSaleModal(null,currentDetailClient)">Log Sale</button>
        <button class="btn" onclick="openTodoModal(null,[currentDetailClient])">Add Outreach</button>
      </div>
    </div>
  </div>

  <!-- Appointment Modal -->
  <div class="modal" id="apptModal">
    <div class="panel">
      <header><h3 id="apptModalTitle">Schedule Appointment</h3><button class="x" onclick="closeModal('apptModal')">‚úï</button></header>
      <label>Title<input id="apptTitle"></label>
      <label>Date/Time<input id="apptDate" type="datetime-local"></label>
      <label>Status<select id="apptStatus"><option value="scheduled">Scheduled</option><option value="completed">Completed</option><option value="canceled">Canceled</option><option value="no-show">No-Show</option></select></label>
      <label>Notes<textarea id="apptNotes"></textarea></label>
      <label>Clients<select id="apptClients" multiple></select></label>
      <div class="buttons" style="justify-content:flex-end">
        <button class="btn ghost" onclick="closeModal('apptModal')">Cancel</button>
        <button class="btn primary" id="saveApptBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Sale Modal -->
  <div class="modal" id="saleModal">
    <div class="panel">
      <header><h3 id="saleModalTitle">Log Sale</h3><button class="x" onclick="closeModal('saleModal')">‚úï</button></header>
      <label>Client<select id="saleClient"></select></label>
      <label>Amount<input id="saleAmount" type="number" step="0.01"></label>
      <label>Date<input id="saleDate" type="date"></label>
      <label>Description<textarea id="saleDesc"></textarea></label>
      <label>Appointment<select id="saleAppt"><option value="">None</option></select></label>
      <div class="buttons" style="justify-content:flex-end">
        <button class="btn ghost" onclick="closeModal('saleModal')">Cancel</button>
        <button class="btn primary" id="saveSaleBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Outreach Modal -->
  <div class="modal" id="todoModal">
    <div class="panel">
      <header><h3 id="todoModalTitle">Add Outreach</h3><button class="x" onclick="closeModal('todoModal')">‚úï</button></header>
      <label>Title<input id="todoTitle"></label>
      <label>Date<input id="todoDate" type="date"></label>
      <label>Category<select id="todoCategory">
        <option>Follow-up</option>
        <option>Pre-appointment</option>
        <option>Cold/Warm Outreach</option>
        <option>Promo</option>
        <option>Event</option>
        <option>Seasonal</option>
      </select></label>
      <label>Notes<textarea id="todoNotes"></textarea></label>
      <label>Clients<select id="todoClients" multiple></select></label>
      <label>Appointment<select id="todoAppt"><option value="">None</option></select></label>
      <div class="buttons" style="justify-content:flex-end">
        <button class="btn ghost" onclick="closeModal('todoModal')">Cancel</button>
        <button class="btn primary" id="saveTodoBtn">Save</button>
      </div>
    </div>
  </div>
/* ===========================
   Helpers & State
=========================== */
const $ = (s, r=document) => r.querySelector(s);
const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

// App state (falls back if not defined elsewhere)
let clients = (window.clients ?? []);
let appointments = (window.appointments ?? []);
let sales = (window.sales ?? []);
let outreach = (window.outreach ?? []);

// Central save/load for your app (adjust keys to your app‚Äôs usage)
const STORAGE_KEY = 'crm-data';
function saveAll(){
  const payload = { exportedAt: new Date().toISOString(), version: 4, clients, appointments, sales, outreach };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
  return payload;
}
function loadAll(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;
  try{
    const data = JSON.parse(raw);
    clients = data.clients || [];
    appointments = data.appointments || [];
    sales = data.sales || [];
    outreach = data.outreach || [];
  }catch(e){ console.warn('Failed to load saved data', e); }
}

/* ===========================
   Export / Import / Clear
=========================== */
// Dropdown controls
const exportToggle = $('#exportToggle');
const exportMenu   = $('#exportMenu');
const exportWrap   = $('#exportDropdown');

function closeExportMenu(){
  exportMenu.classList.remove('show');
  exportToggle?.setAttribute('aria-expanded','false');
}
function openExportMenu(){
  exportMenu.classList.add('show');
  exportToggle?.setAttribute('aria-expanded','true');
}

exportToggle?.addEventListener('click', (e)=>{
  e.stopPropagation();
  const open = exportMenu.classList.contains('show');
  open ? closeExportMenu() : openExportMenu();
});
document.addEventListener('click', (e)=>{
  if (exportWrap && !exportWrap.contains(e.target)) closeExportMenu();
});
document.addEventListener('keydown', (e)=>{
  if (e.key === 'Escape') closeExportMenu();
});
exportToggle?.addEventListener('keydown', (e)=>{
  if (e.key === 'ArrowDown'){
    openExportMenu();
    const first = exportMenu.querySelector('.btn');
    first && first.focus();
  }
});

// Export JSON
$('#exportJsonBtn')?.addEventListener('click', ()=>{
  const data = saveAll(); // ensure latest
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'crm-data.json';
  a.click();
  closeExportMenu();
});

// Export CSV (unified format)
$('#exportCsvBtn')?.addEventListener('click', ()=>{
  const headers = [
    "Type","ClientId","First","Last","Email","Phone","Birthday","Styles","Brands",
    "Shirt","Dress","Pant","Shoe","InitialSale","Notes","Title","Date","Category",
    "Clients","Amount","Desc","Status"
  ];
  const rows = [];

  // Clients
  (clients||[]).forEach(c=>{
    rows.push([
      "Client", c.id || "", c.first || "", c.last || "", c.email || "", c.phone || "",
      c.birthday || "", (c.styles||[]).join('|'), (c.brands||[]).join('|'),
      c.sizeShirt || "", c.sizeDress || "", c.sizePant || "", c.sizeShoe || "",
      c.initialSale ?? "", c.notes || "", "", "", "Client", "", "", "", ""
    ]);
  });

  // Appointments
  (appointments||[]).forEach(a=>{
    rows.push([
      "Appointment", a.clientId || "", "", "", "", "", "", "", "", "", "", "", "", "",
      "", a.title || "", a.date || "", "Appointment",
      Array.isArray(a.clientIds) ? a.clientIds.join('|') : (a.clientId || ""),
      "", a.desc || "", a.status || ""
    ]);
  });

  // Sales
  (sales||[]).forEach(s=>{
    rows.push([
      "Sale", s.clientId || "", "", "", "", "", "", "", "", "", "", "", "", "",
      "", s.title || s.desc || "Sale", s.date || "", "Sale",
      s.clientId || "", s.amount ?? "", s.desc || "", s.status || ""
    ]);
  });

  // Outreach
  (outreach||[]).forEach(o=>{
    rows.push([
      "Outreach", "", "", "", "", "", "", "", "", "", "", "", "", "", "",
      o.title || "", o.date || "", o.category || "Outreach",
      Array.isArray(o.clientIds) ? o.clientIds.join('|') : "", "", o.desc || "", o.status || ""
    ]);
  });

  const csv = [headers.join(',')].concat(
    rows.map(r=>r.map(x => `"${(x??'').toString().replace(/"/g,'""')}"`).join(','))
  ).join('\n');

  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'crm-data.csv';
  a.click();
  closeExportMenu();
});

// Import JSON
$('#importBtn')?.addEventListener('click', ()=> $('#importFile')?.click());
$('#importFile')?.addEventListener('change', async (e)=>{
  const file = e.target.files?.[0];
  if(!file) return;
  try{
    const text = await file.text();
    const data = JSON.parse(text);

    clients = data.clients || data?.data?.clients || clients || [];
    appointments = data.appointments || data?.data?.appointments || appointments || [];
    sales = data.sales || data?.data?.sales || sales || [];
    outreach = data.outreach || data?.data?.outreach || outreach || [];

    saveAll();
    toast('‚úÖ Data imported');
    // If you have render() in your app, call it here.
    // renderAll();
  }catch(err){
    console.error(err);
    toast('‚ö†Ô∏è Import failed: invalid JSON');
  }finally{
    e.target.value = '';
  }
});

// Clear Data
$('#clearBtn')?.addEventListener('click', ()=>{
  confirmModal({
    title: 'Clear all data?',
    message: 'This will remove all locally stored CRM data.',
    confirmText: 'Yes, clear it',
    confirmKind: 'danger',
    onConfirm: ()=>{
      localStorage.removeItem(STORAGE_KEY);
      clients = []; appointments = []; sales = []; outreach = [];
      toast('üóëÔ∏è Data cleared');
      // renderAll && renderAll();
    }
  });
});

/* ===========================
   Mini UI Utilities (Toast + Modal)
=========================== */
function toast(msg, timeout=2000){
  let el = $('#toast');
  if(!el){
    el = document.createElement('div');
    el.id = 'toast';
    Object.assign(el.style, {
      position:'fixed', left:'50%', bottom:'24px', transform:'translateX(-50%)',
      background:'var(--card)', border:'1px solid var(--ring)', padding:'10px 14px',
      borderRadius:'12px', boxShadow:'var(--shadow)', zIndex:1000, fontWeight:'700'
    });
    document.body.appendChild(el);
  }
  el.textContent = msg;
  el.style.opacity = '1';
  setTimeout(()=>{ el.style.opacity = '0' }, timeout);
}

function confirmModal({title, message, confirmText='Confirm', cancelText='Cancel', confirmKind='default', onConfirm}){
  // Build modal
  const wrap = document.createElement('div');
  Object.assign(wrap.style, {
    position:'fixed', inset:'0', background:'rgba(0,0,0,.35)', display:'grid',
    placeItems:'center', zIndex:1000, padding:'20px'
  });

  const card = document.createElement('div');
  card.className = 'surface';
  card.style.maxWidth = '460px';
  card.style.width = '100%';

  card.innerHTML = `
    <h3 style="margin:0 0 10px; font-size:1.25rem">${title}</h3>
    <p style="margin:0 0 16px; color:var(--muted)">${message}</p>
    <div style="display:flex; gap:8px; justify-content:flex-end">
      <button class="btn ghost" id="mCancel">${cancelText}</button>
      <button class="btn ${confirmKind==='danger'?'danger':''}" id="mConfirm">${confirmText}</button>
    </div>
  `;

  wrap.appendChild(card);
  document.body.appendChild(wrap);

  $('#mCancel', card).addEventListener('click', ()=> document.body.removeChild(wrap));
  $('#mConfirm', card).addEventListener('click', ()=>{
    document.body.removeChild(wrap);
    onConfirm && onConfirm();
  });

  // Esc closes
  const esc = (e)=>{ if(e.key==='Escape'){ document.body.removeChild(wrap); document.removeEventListener('keydown',esc); } };
  document.addEventListener('keydown', esc);
}

/* ===========================
   Boot
=========================== */
(function init(){
  loadAll();
  // If you have renderers elsewhere, you can call renderAll() here.
  // renderAll();
})();
</Script>

</body>
</html>








